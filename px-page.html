<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="overthrow-import.html"/>
<link rel="import" href="px-page-transitions.html"/>
<link rel="import" href="px-page-behavior.html"/>
<!--<link rel="import" href="../neon-animation/neon-animation-behavior.html">-->
<link rel="import" href="../neon-animation/animations/slide-left-animation.html">
<link rel="import" href="../neon-animation/animations/slide-right-animation.html">
<link rel="import" href="../neon-animation/neon-animation-runner-behavior.html">
<!--

The `px-page` element provides a simple container that enables scrollable content. When used with the `px-navbar` element
the page will update the `px-navbar` element with its title and/or back button.


### Usage

```

```

### Styling
The following custom properties are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--px-page` | Mixin applied to component | {}

@element px-page
@demo demo.html
@homepage index.html
-->
<dom-module id="px-page">
  <template>
    <style media="screen">
      :host {
        display: block;
        box-sizing: border-box;
      }

      :host.dialog {
        -webkit-transition: all 0.3s ease;
        transition: all 0.3s ease;
        position: fixed;
        left: 0;
        right: 0;
        -webkit-transform: translateY(0);
        transform: translateY(0);
        z-index: 100;
        background: #fff;
        height: 100%;
      }

      :host.dialog:not(.is-open) {
        z-index: -1;
        -webkit-transform: translateY(100%);
        transform: translateY(100%);
      }

      .overthrow,
      :host .overthrow {
        overflow: auto;
        height: 100%;
        -webkit-overflow-scrolling: touch;
      }
      .overthrow-enabled .c-page__content {
        height: 100%;
      }

      :host ::content > div{
        height: 100%;
        background-color: crimson;
      }

      :host .has-navbar {
        margin-top: 56px;
      }
    </style>
    <div id="pageContainer" class="c-page__container">
      <div class="pageNavbar" class="c-page__navbar">
        <content id="navbarContent" select="px-navbar"></content>
      </div>
      <div id="pageContent" class="c-page__content overthrow">
        <content id="pageContent" select=":not(px-navbar)"></content>
      </div>
    </div>
  </template>
</dom-module>
<script type="text/javascript">
  Polymer({
    is: 'px-page',
    behaviors: [
      Polymer.IronResizableBehavior,
      Polymer.NeonAnimationRunnerBehavior,
      //Polymer.NeonAnimatableBehavior,
      PageBehavior
    ],
    properties: {
      /**
       * The entry animation to play when page is selected
       */
      entryAnimation: {
        value: 'slide-left-animation'
      },
      /**
       * The exit animation to play when page is not selected
       */
      exitAnimation: {
        value: 'slide-right-animation'
      },
      /**
       * The title for the page
       */
      title: {
        type: String,
        value: null
      },
      /**
       * URL to load as the pages content
       */
      import: {
        type: String,
        notify: true,
        value: null,
        observer: '_tmplChanged'
      },
      /**
       * If the page is currently active in the viewport
       */
      active: {
        type: Boolean
      },
      /**
       * If the page is the main page
       */
      main: {
        type: Boolean
      },
      /**
       * If the page is a dialog
       */
      dialog: {
        type: Boolean
      },
      /**
       * The context data object associated with the page
       */
      context: {
        type: Object
      },
      /**
       * The page that came before this page
       */
      fromPage: {
        type: Object
      }
    },
    listeners: {
      // this event is fired when the animation finishes
      'neon-animation-finish': '_onNeonAnimationFinish'
    },
    /**
     * A reference to the px-navbar element. (if it exists)
     * @property navbar
     * return Element
     */
    get navbar() {
      return Polymer.dom(this.$.navbarContent).getDistributedNodes()[0];
    },
    /**
     * A reference to the parent px-pages element.
     * @property pages
     * return Element
     */
    get pages() {
      return Polymer.dom(this).parentNode;
    },
    ready: function () {
      this.toggleClass('c-page');
    },
    attached: function () {
      this._wireNavbar();
    },
    _wireNavbar: function(){
      this.async(function(){
        if (this.navbar && this.pages) {
          this.toggleClass('has-navbar', true, this.$.pageContent)
          this.navbar.pagesContainer = this.pages;
          this.listen(this.navbar, 'px-navbar-back', '_handleBack');
        }
      });
    },
    _onNeonAnimationFinish: function () {
      console.log('animation done!');
    },
    _handleBack: function (e) {
      if (this.pages) {
        this.pages.back();
      }
    },
    animate: function () {
      this.playAnimation();
    },
    show: function () {
      this.active = true;
      this.playAnimation('entry');
    },
    hide: function () {
      this.active = false;
      this.playAnimation('exit');
    },
    open: function () {
      if (this.dialog) {
        this.toggleClass(this.currentClass);
        this.toggleClass('is-open');
      }
    },
    close: function () {
      if (this.dialog) {
        this.toggleClass('is-open');
      }
    },
    _tmplChanged: function (newVal, oldVal) {
      var _this = this,
        html = '';
      if (newVal) {
        this.importHref(newVal, function (e) {
          html = e.target.import.body.innerHTML;
          Polymer.dom(_this.$.pageContent).appendChild(e.target.import.body.firstChild);
          _this._wireNavbar();
        }, function (err) {
          console.error('Error loading page', err);
        });
      }
    }
  });
</script>
