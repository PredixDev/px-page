<link rel="import" href="../px-base-element/px-base-element.html" />
<script src="overthrow/overthrow-detect.js"></script>
<script src="overthrow/overthrow-polyfill.js"></script>
<script src="overthrow/overthrow-toss.js"></script>
<script src="overthrow/overthrow-init.js"></script>
<script type="text/javascript">
  var PageBehavior = {
    properties : {
      title : {
        type : String,
        value: null
      },

      backText:{
        type: String,
        value: null
      },

      backLink:{
        type: String,
        value: null
      },

      //Path to remote view that will be loaded
      import:{
        type: String,
        notify: true,
        value: null,
        observer: '_tmplChanged'
      },

      active : {
        type : Boolean,
        value : false,
      },

      modal : {
        type : Boolean,
        value : false,
      },
      dialog : {
        type : Boolean,
        value : false,
      },

      //with URL query parameters. If your page URL is "about.html?id=10&count=20&color=blue"
      query : {
        type : Object
      },

      context : {
        type : Object
      },

      //View instance that contains this page (if this View was initialized)
      view : {
        type : Object
      },
      //Page Data object of the previously active page
      fromPage : {
        type : Object
      },

      route: {
        type: String
      },

      //Contains string URL of just loaded page
      url: {
        type: String
      },
      //Link to Page HTMLElement
      container: {
        type: String
      },
      //Reference to the page navbar.
      navbar: {
        type: Object
      }
    },
    created : function() {
      this.logger.logApi('created', this.id);
      pxMobile.PubSub.emit('page:'+this.id+':init', this);
    },
    ready : function() {
      this.logger.logApi('ready', this.id);
      if(this.dialog){
        this.toggleClass('dialog');
      }
      this.fire('page:ready', this);
      pxMobile.PubSub.emit('page:'+this.id+':ready', this);
    },
    attached: function(){
      this._fixNavbar();
    },
    _fixNavbar: function(){
      var w = this.parentNode.offsetWidth;
      var h = this.parentNode.offsetHeight;
      var pageContent = this.$.pageContent;
      var pageNavbar = this.queryEffectiveChildren('px-navbar');

      if(pageNavbar){

        pageContent.css('margin-top', pageNavbar.offsetHeight + 'px');

        if(this.theme){
          pageNavbar.theme = this.theme;
        }

        if(this.title){
          pageNavbar.title = this.title;
        }
        this.navbar = pageNavbar;
      }
    },
    show: function(){
      console.warn('INFO', 'show view', this.id);
      this.toggleClass('current', false, this);
    },
    hide: function(){
      console.warn('INFO', 'hide view', this.id);
      this.toggleClass('hidden', true, this);
    },
    update: function(){
      console.warn('INFO', 'update view', this.id);
    },
    currentView: function(){
      console.warn('INFO', 'current view', this.id);
      this.child()[0].toggleClass('current', true, this);
    },
    nextView: function(){
      console.warn('INFO', 'next view', this.id);
      this.toggleClass('next', true, this);
    },
    previousView: function(){
      console.warn('INFO', 'previous view', this.id);
      this.toggleClass('previous', true, this);
    },
    contextChanged : function(newContext, oldContext) {
      console.warn('contextChanged', newContext, oldContext);
    },

    //I handle loading a page from a url
    _tmplChanged: function(newVal, oldVal){
      var _this = this, html = '';
      if(newVal){
      	console.warn(this.id, 'Load remote html', newVal);

        this.importHref(newVal, function(e) {
        	html = e.target.import.body.innerHTML;
        	_this.logger.logApi('inject html', _this.id);
          console.warn('inject px-view html', _this.id);
          _this.html(html);
        }, function(e) {
            // loading error
            console.error('Error loading page', e);
        });
      }
    },
    showMenu:function(){
      pxMobile.dom('px-app').toggleClass('show-menu');
    },
    open: function(){
      if(this.dialog){
        this.toggleClass('open');
      }
    },
    close: function(){
      if(this.dialog){
        this.toggleClass('open');
      }
    }
  };

</script>
